// package main
package main

import (
	"flag"
	"fmt"
	"log"
	"particles/particles"
	"time"
)

var c = `               .........:--===++++======================++++===--:.........
              ...:-=*#%%%%%%%%%%###***+++++++++++++****##%%%%%%%%%%#*+=::...
              :::.:--=+**##%%%%%%%###***************####%%%%%%%##**+=-:..:::
              :::::::..........::::::::::::::::::::::::::::.........::::::::
              ::::........................     ...................:::::::::.
              :===:......................        .................:::::--==..
               :---==-:::-=-:::..........        ..........::--=====+*+=--:......
               ::::..::::-==+++******++++++++++++++++******++======-::::::.   ....
               .:::........................::::..................:::::::::     ....
                ::::............................................:::::::::.     ....
                 :::......::..................................:::::::::::      ....
                 .:::.....::::..............................::::::::::::.    .....
                  ::::.....:::::::......................:::::::::::::::::::......
                   ::::....::::::::::::::::....::::::::::::::::::::::::::::....
                  .:::::...:::::::::::::::::::::::::::::::::::::::::::..
             ..::---:::::...::::::::::::::::::::::::::::::::::::::::::---:::.
         .::---------::::::..::::::::::::::::::::::::::::::::::::::::---------::.
       ::-----------::::::::..:::::::::::::::::::::::::::::::::::::::------------::.
     .:-------::::::::::::::::.::::::::::::::::::::::::::::::::::::::::::::---------:
    .-----:::::::::::::----:::::::::::::::::::::::::::::::::::------:::::::::::------.
    .--:::::::::::::::-----===-::::::::::::::::::::::::::::-===-----::::::::::::::---.
    ..::::::::::::::::::---=+***+=-::::::::::::::::::::-=+**+==---::::::::::::::::::..
     ..::::::::::::::::::::--==++***++==---------===++**+++=--:::::::::::::::::::::..
     ..:-::::::::::::::::::::::::-----==============-----::::::::::::::::::::::::-:..
       ..:==-::.::::::::::::::::....:::::::::::::::::::::::::::::::::::::::.:-==:..
         ...:-=+==-::...:::::::::::::...............:::::::::::::::..::--=+==::..
            ...::-=++**++==---:::.........................:::--==++**++=-::...
                 ....::--==++***#####*****************####***++==--::.....
                       ......::::::----============----::::::......
                                 ........................


`

var effects = map[string]particles.ASCII{
	"steam": particles.ASCIISteam,
	"fire":  particles.ASCIIFire,
}

func main() {

	argType := flag.String("effect", "steam", "Specify the particle effect: 'steam' or 'fire'")
	flag.Parse()

	effect, ok := effects[*argType]
	if !ok {
		log.Fatalf("Invalid effect type: %s", *argType)
	}

	// Feel free to experiment!
	params := particles.ParticleParams{
		MaxLife:       6000,
		MaxSpeed:      1.5,
		ParticleCount: 700,

		XStDeviation: 9.0,
		X:            61, // width set according to the coffee cup ascii art!
		Y:            8,

		Ascii: effect,
	}

	// Pour and enjoy!
	coffee := particles.NewCoffee(params)
	coffee.Start()

	timer := time.NewTicker(100 * time.Millisecond)
	for {
		<-timer.C
		fmt.Printf("\033[H\033[2J")
		coffee.Update()
		steam := coffee.Display()
		for _, row := range steam {
			fmt.Printf("              %s\n", row)
		}
		fmt.Println(c)
	}
}
