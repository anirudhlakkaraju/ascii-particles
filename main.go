// package main
package main

import (
	"fmt"
	"log"
	"particles/args"
	"particles/particles"
	"time"
)

var c = `               .........:--===++++======================++++===--:.........
              ...:-=*#%%%%%%%%%%###***+++++++++++++****##%%%%%%%%%%#*+=::...
              :::.:--=+**##%%%%%%%###***************####%%%%%%%##**+=-:..:::
              :::::::..........::::::::::::::::::::::::::::.........::::::::
              ::::........................     ...................:::::::::.
              :===:......................        .................:::::--==..
               :---==-:::-=-:::..........        ..........::--=====+*+=--:......
               ::::..::::-==+++******++++++++++++++++******++======-::::::.   ....
               .:::........................::::..................:::::::::     ....
                ::::............................................:::::::::.     ....
                 :::......::..................................:::::::::::      ....
                 .:::.....::::..............................::::::::::::.    .....
                  ::::.....:::::::......................:::::::::::::::::::......
                   ::::....::::::::::::::::....::::::::::::::::::::::::::::....
                  .:::::...:::::::::::::::::::::::::::::::::::::::::::..
             ..::---:::::...::::::::::::::::::::::::::::::::::::::::::---:::.
         .::---------::::::..::::::::::::::::::::::::::::::::::::::::---------::.
       ::-----------::::::::..:::::::::::::::::::::::::::::::::::::::------------::.
     .:-------::::::::::::::::.::::::::::::::::::::::::::::::::::::::::::::---------:
    .-----:::::::::::::----:::::::::::::::::::::::::::::::::::------:::::::::::------.
    .--:::::::::::::::-----===-::::::::::::::::::::::::::::-===-----::::::::::::::---.
    ..::::::::::::::::::---=+***+=-::::::::::::::::::::-=+**+==---::::::::::::::::::..
     ..::::::::::::::::::::--==++***++==---------===++**+++=--:::::::::::::::::::::..
     ..:-::::::::::::::::::::::::-----==============-----::::::::::::::::::::::::-:..
       ..:==-::.::::::::::::::::....:::::::::::::::::::::::::::::::::::::::.:-==:..
         ...:-=+==-::...:::::::::::::...............:::::::::::::::..::--=+==::..
            ...::-=++**++==---:::.........................:::--==++**++=-::...
                 ....::--==++***#####*****************####***++==--::.....
                       ......::::::----============----::::::......
                                 ........................


`

func main() {

	particles.LoadEffects()

	// Parse the command-line arguments
	argEffect, argAdd, argList := args.ParseArgs()

	// Handle --list flag
	if *argList {
		args.HandleList()
		return
	}

	// Handle --add flag
	if *argAdd != "" {
		args.HandleAdd(*argAdd)
		return
	}

	// Determine the effect type
	effect, ok := particles.Effects[*argEffect]
	if !ok {
		log.Fatalf("Invalid effect type: %s", *argEffect)
	}

	// Feel free to experiment!
	params := particles.ParticleParams{
		MaxLife:       7000,
		MaxSpeed:      1.5,
		ParticleCount: 700,

		XStDeviation: 9.0,
		X:            61, // width set according to the coffee cup ascii art!
		Y:            9,

		ParticleEffect: particles.NewParticleEffect(*effect),
	}

	// Pour and enjoy!
	coffee := particles.NewCoffee(params)
	coffee.Start()

	timer := time.NewTicker(100 * time.Millisecond)
	for {
		<-timer.C
		fmt.Printf("\033[H\033[2J")
		coffee.Update()
		steam := coffee.Display()
		for _, row := range steam {
			fmt.Printf("              %s\n", row)
		}
		fmt.Println(c)
	}
}
